{"version":3,"sources":["/script/modules/trackcontrol/views/monitorallcontent.js"],"names":[],"mappings":"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","file":"/script/modules/trackcontrol/views/monitorallcontent.js","sourcesContent":["/* globals map */\r\n/* globals BMap */\r\n/* globals Reflux */\r\n/* globals mapv */\r\n/* globals dataSet */\r\n/* globals mapControl */\r\n/* eslint-disable fecs-camelcase */\r\n/* eslint-disable max-len */\r\n/**\r\n * @file 实时监控全部 Reflux View\r\n * @author 崔健 cuijian03@baidu.com 2016.08.23\r\n */\r\nimport React, { Component } from 'react'\r\nimport { render } from 'react-dom'\r\nimport TrackStore from '../stores/trackStore'\r\nimport CommonStore from '../../common/stores/commonStore'\r\nimport MonitorAllPage from 'monitorallpage'\r\nimport TrackAction from '../actions/trackAction'\r\n\r\nvar Monitorallcontent = React.createClass({\r\n    getInitialState: function() {\r\n        return {\r\n            // 页签编码 0为实时监控 1为终端管理\r\n            tabIndex: 0,\r\n            // 页签编码 0为实时监控 1为终端管理\r\n            manageTabIndex: 0,\r\n            // monitor三种列表类型编码 0全部 1在线 2离线\r\n            monitorTabIndex: 0,\r\n            // 父容器可见性\r\n            parentVisible: {},\r\n            // 当前列表内容\r\n            allEntity: [],\r\n            // 当前选中车的坐标\r\n            currentPoint: {},\r\n            // 当前选中的entityname\r\n            currentEntityName: '',\r\n            // service  类型\r\n            service_type: 0\r\n        }\r\n    },\r\n    componentDidMount: function () {\r\n        TrackStore.listen(this.onStatusChange);\r\n        CommonStore.listen(this.onStatusChange);\r\n        TrackAction.listcolumn();\r\n    }, \r\n    onStatusChange: function (type,data) {\r\n        switch (type){\r\n            case 'switchmanagetab':\r\n                this.listenSwitchmanageTab(data);\r\n            break;\r\n            case 'switchtab':\r\n                this.listenSwitchTab(data);\r\n            break;\r\n            case 'switchmonitortab':\r\n                this.listenSwitchMonitorTab(data);\r\n            break;\r\n            case 'listcolumn':\r\n                this.listenListColumn();\r\n            break;\r\n            case 'alllist':\r\n                this.listenAllList(data);\r\n            break;\r\n            case 'selectcardata':\r\n                this.listenSelectCarData(data);\r\n            break;\r\n            case 'hideselectcar':\r\n                this.listenHideSelectCar();\r\n            break;\r\n            case 'servicetype':\r\n                this.listenServicetype(data);\r\n            break;\r\n            case 'boundsearchentity':\r\n                this.listenBoundsearchentity(data);\r\n                break;\r\n        }\r\n    },\r\n    /**\r\n     * 响应Store list事件，设置标签页\r\n     *\r\n     * @param {data} 标签页标识\r\n     */\r\n    listenSwitchmanageTab: function(data) {\r\n        var that = this;\r\n        if (data === 0){\r\n            this.setState({parentVisible: {}});\r\n            this.setState({manageTabIndex: 0});\r\n        } else {\r\n            this.setState({parentVisible: {visibility: 'inherit'}});\r\n            this.setState({manageTabIndex: 1});\r\n        }\r\n    },\r\n    /**\r\n     * 响应Store switchtab事件，隐藏manage\r\n     *\r\n     * @param {data} 标签页标识\r\n     */\r\n    listenSwitchTab: function(data) {\r\n        var that = this;\r\n        if (data === 0){\r\n            switch (that.state.monitorTabIndex) {\r\n                case 0:\r\n                    this.setState({parentVisible: {visibility: 'inherit'}});\r\n                break;\r\n                case 1:\r\n                    this.setState({parentVisible: {}});\r\n                break;\r\n                case 2:\r\n                    this.setState({parentVisible: {}});\r\n                break;\r\n            }        \r\n            this.setState({tabIndex: 0});\r\n        } else {\r\n            this.setState({parentVisible: {visibility: 'inherit'}});\r\n            this.setState({tabIndex: 1});\r\n        }\r\n    },\r\n    /**\r\n     * 响应Store switchmonitortab事件,设置标签页\r\n     *\r\n     * @param {data} 标签页标识\r\n     */\r\n    listenSwitchMonitorTab: function(data) {\r\n        this.setState({parentVisible: {}});\r\n        this.setState({monitorTabIndex: data});\r\n    },\r\n    /**\r\n     * 响应Store listcolumn事件,设置标签页\r\n     *\r\n     */\r\n    listenListColumn: function() {\r\n        TrackAction.searchallentity(1);\r\n    },\r\n    /**\r\n     * 响应Store alllist事件,设置列表\r\n     *\r\n     * @param {data} entity数据\r\n     */\r\n    listenAllList: function(data) {\r\n        this.setState({allEntity:data});\r\n        if (this.state.manageTabIndex === 0){\r\n            TrackAction.selectcar();\r\n        }\r\n    },\r\n    /**\r\n     * 响应Store selectcardata事件,显示被选车辆\r\n     *\r\n     * @param {data} 选中entity数据\r\n     */\r\n    listenSelectCarData: function(data) {\r\n        mapControl.removeMonitorInfoBox();\r\n        mapControl.removeEntityMarker();\r\n\r\n        mapControl.setEntityMarker(data, this.state.service_type);\r\n        mapControl.setMonitorInfoBox(data);\r\n\r\n    },\r\n\r\n    /**\r\n     * 响应Store boundsearchentity事件,显示范围内车辆\r\n     *\r\n     * @param {Array} data 范围内entity数据\r\n     */\r\n    listenBoundsearchentity(data) {\r\n        let that = this;\r\n        let markerArr = [];\r\n        let MarkerOption = {};\r\n        if (that.state.service_type === 1) {\r\n            // MarkerOption.height = 41;\r\n            // MarkerOption.width = 34;\r\n        } else {\r\n            MarkerOption.height = 27;\r\n            MarkerOption.width = 22;\r\n        }\r\n        if (data.length === 0) {\r\n            mapControl.setBoundSearch([], MarkerOption);\r\n        } else {\r\n            data.map(function (item, index) {\r\n                let img = mapControl.getEntityIcon(that.state.service_type, item);\r\n                img.onload = function () {\r\n                    markerArr.push({\r\n                        geometry: {\r\n                            type: 'Point',\r\n                            coordinates: [item.point[0], item.point[1]]\r\n                        },\r\n                        icon: img,\r\n                        deg: item.direction ? item.direction : 0,\r\n                        entity_name: item.entity_name,\r\n                        entity_status: item.entity_status\r\n                    });\r\n                    if (markerArr.length === data.length) {\r\n                        mapControl.setBoundSearch(markerArr, MarkerOption);\r\n                    }\r\n                };\r\n            });\r\n        }\r\n    },\r\n\r\n    /**\r\n     * 响应Store selectcardata事件,显示被选车辆\r\n     *\r\n     */\r\n    listenHideSelectCar() {\r\n        mapControl.removeMonitorInfoBox();\r\n        mapControl.removeEntityMarker();\r\n    },\r\n    /**\r\n     * 响应Store servicetype事件,显示被选车辆\r\n     *\r\n     * @param {data} 选中entity数据\r\n     */\r\n    listenServicetype: function(data) {\r\n        this.setState({service_type: data});\r\n        // console.log('type:' + data);\r\n    },\r\n\r\n    /**\r\n     * DOM操作回调，点击选中一辆车\r\n     *\r\n     * @param {object} event 事件对象 \r\n     */\r\n    handleSelectCar: function(event) {\r\n        var realTarget = event.target;\r\n        if (event.target.parentElement.className.indexOf('monitorListItem') > -1) {\r\n            realTarget = event.target.parentElement;\r\n        }\r\n        if (event.target.parentElement.parentElement.className.indexOf('monitorListItem') > -1) {\r\n            realTarget = event.target.parentElement.parentElement;\r\n        }\r\n        var entity_name = realTarget.getAttribute('data-entity_name');\r\n        var entity_status = realTarget.getAttribute('data-entity_status');\r\n        var entity_id = realTarget.getAttribute('data-entity_id');\r\n        this.setState({currentEntityName: entity_name});\r\n        TrackAction.selectcar(entity_name, entity_status, entity_id, 'allCompleteEntities');\r\n    },\r\n    render: function() {\r\n        var monitorTabIndex = this.state.monitorTabIndex;\r\n        var parentVisible = this.state.parentVisible;\r\n        var allEntity = this.state.allEntity;\r\n        var handleSelectCar = this.handleSelectCar;\r\n        var currentEntityName = this.state.currentEntityName;\r\n        return (\r\n            <div className={monitorTabIndex === 0 ? 'monitorAllContent visible' : 'monitorAllContent hidden'} style={parentVisible} >\r\n                    <div className=\"monitorFrame\">\r\n                    {\r\n                        allEntity.map(function(item, key) {\r\n                            return (\r\n                                <div className={'monitorListItem' + item[2] + ((currentEntityName === item[0]) ? ' monitorSelect' : '')} key={key} data-entity_name={item[0]} data-entity_desc={item[4]} data-entity_status={item[2]} data-entity_id={item[3]} onClick={handleSelectCar}>\r\n                                    <div className=\"monitorListItemName\" ><abbr title={item[5]}>{item[5]}</abbr></div>\r\n                                    <div className=\"monitorListItemSpeed\">{item[1]}</div>\r\n                                </div>\r\n                                )\r\n                        })\r\n                    }\r\n                    </div>\r\n                <MonitorAllPage />\r\n            </div>\r\n\r\n        )\r\n    }\r\n});\r\n\r\nexport default Monitorallcontent;\r\n"]}